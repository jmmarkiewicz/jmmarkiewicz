<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dynamic Word Cloud — AI Theme</title>
  <!-- If you saved theme.css from my earlier message, keep this link. Otherwise this file is self-contained. -->
  <!-- <link rel="stylesheet" href="theme.css" /> -->
  <style>
    /* =========================
       THEME TOKENS (inline copy)
       ========================= */
    :root{
      --color-primary: #64ffda;
      --color-primary-2: #00bcd4;
      --color-bg-0: #0a0a0a;
      --color-bg-1: #1a1a2e;
      --color-bg-2: #16213e;
      --color-bg-3: #0f3460;
      --color-bg-4: #533a7d;
      --color-text: #e0e6ed;
      --color-white-10: rgba(255,255,255,.1);
      --color-white-05: rgba(255,255,255,.05);

      --glass-bg: rgba(255,255,255,0.05);
      --glass-border: rgba(255,255,255,0.1);
      --glass-blur: 20px;

      --font-sans: -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',sans-serif;

      --radius-xl: 24px;
      --pad-lg: 24px; /* tighter for cloud layout */
      --shadow-elev: 0 32px 64px rgba(0,0,0,.4);
    }

    /* App background + viewport discipline */
    html, body { height: 100%; }
    body.theme-ai {
      margin: 0;
      background: linear-gradient(135deg,
        var(--color-bg-0) 0%, var(--color-bg-1) 25%, var(--color-bg-2) 50%, var(--color-bg-3) 75%, var(--color-bg-4) 100%);
      font-family: var(--font-sans);
      color: var(--color-text);
      /* Safari full-screen friendly viewport units */
      min-height: 100svh; /* small viewport height, better with iOS UI */
      height: 100svh;
      width: 100vw;
      overflow: hidden; /* ✱ no page scroll */
      display: grid;
      /* Layout: nav top-left fixed; info bottom-right fixed; main centered */
      place-items: center;
      position: relative;
    }

    /* Neural background */
    .neural-network{ position:absolute; inset:0; pointer-events:none; opacity:.1; }
    .nn-node{ position:absolute; width:3px; height:3px; background: var(--color-primary); border-radius:50%; animation: nnPulse 4s ease-in-out infinite; }
    .nn-conn{ position:absolute; height:1px; background: linear-gradient(90deg, transparent, var(--color-primary), transparent); transform-origin:left center; animation: nnFlow 3s ease-in-out infinite; }
    @keyframes nnPulse{ 0%,100%{opacity:.3; transform:scale(1)} 50%{opacity:1; transform:scale(1.5)} }
    @keyframes nnFlow{ 0%{opacity:0; transform:scaleX(0)} 50%{opacity:.8; transform:scaleX(1)} 100%{opacity:0; transform:scaleX(0)} }

    /* Nav pills */
    .nav-pills{ position: fixed; top: 20px; left: 20px; display:flex; gap:12px; z-index: 20; }
    .nav-pills a{
      background: var(--glass-bg); backdrop-filter: blur(10px);
      color: var(--color-text); padding:10px 16px; border-radius:25px; text-decoration:none;
      font-weight:500; font-size:14px; border:1px solid var(--glass-border); transition:.3s;
    }
    .nav-pills a:hover{ background: rgba(100,255,218,.2); border-color: rgba(100,255,218,.3); transform: translateY(-2px); box-shadow: 0 8px 25px rgba(100,255,218,.2); }

    /* Info chip */
    .ts-info{ position:fixed; bottom:20px; right:20px; z-index:20; color: rgba(255,255,255,.85); font-size:12px; background: var(--glass-bg); padding:10px 14px; border-radius:12px; backdrop-filter: blur(10px); max-width: 320px; }

    /* Main card */
    .card-glass{
      background: var(--glass-bg);
      backdrop-filter: blur(var(--glass-blur));
      border:1px solid var(--glass-border);
      border-radius: var(--radius-xl);
      padding: var(--pad-lg);
      width: min(1200px, 92vw);
      height: min(80svh, 720px); /* keep within one screen */
      box-shadow: var(--shadow-elev), inset 0 1px 0 var(--glass-border);
      display: grid;
      grid-template-rows: auto 1fr; /* controls + cloud */
      gap: 16px;
      position: relative;
      z-index: 10;
    }

    /* Controls bar */
    .controls{
      display: grid;
      grid-template-columns: 1fr auto auto auto;
      gap: 12px;
      align-items: center;
    }
    .controls-inner{
      display:flex; gap:12px; align-items:center; flex-wrap: wrap;
    }

    input#wordInput{
      border:1px solid var(--color-white-10); border-radius: 10px; padding: 10px 14px; font-size: 16px; width: 100%;
      background: rgba(255,255,255,.06); color: var(--color-text);
    }
    input#wordInput::placeholder{ color: #9fb2c4; }
    input#wordInput:focus{ outline: none; border-color: var(--color-primary); box-shadow: 0 0 0 3px rgba(100,255,218,.18); }

    .btn{
      background: linear-gradient(45deg, var(--color-primary), var(--color-primary-2));
      border: none; border-radius: 10px; padding: 10px 16px; color: #0a0a0a; font-weight: 700; cursor: pointer; transition:.25s; font-size: 14px;
    }
    .btn:hover{ transform: translateY(-1px); box-shadow: 0 6px 16px rgba(0,0,0,.25); }
    .btn.alt{ background: linear-gradient(45deg, #b57bff, #ff77aa); color:#0a0a0a; }

    .word-count{ font-size: 13px; opacity:.85; }

    /* Cloud area never forces page scroll; internal overflow auto if needed */
    .cloud-container{
      background: rgba(255,255,255,0.02);
      border:1px dashed var(--color-white-10);
      border-radius: 14px;
      padding: 18px;
      overflow: auto; /* internal scroll only if needed */
      display: flex; align-items: flex-start; justify-content: center; flex-wrap: wrap; gap: 12px;
    }

    .word-item{
      display:inline-block; font-weight: 800; cursor: pointer; transition: transform .2s ease, filter .2s ease, box-shadow .2s ease;
      padding: 6px 10px; border-radius: 999px; text-decoration: none; position: relative; will-change: transform;
    }
    .word-item:hover{ transform: scale(1.07); filter: saturate(1.2); }

    .empty-state{ opacity:.7; font-style: italic; }

    @media (max-width: 920px){
      .card-glass{ width: 94vw; height: min(84svh, 760px); }
      .controls{ grid-template-columns: 1fr; gap: 10px; }
      .controls-inner{ flex-wrap: wrap; }
    }
  </style>
</head>
<body class="theme-ai">
  <div id="neuralNetwork" class="neural-network" aria-hidden="true"></div>

  <nav class="nav-pills">
    <a href="wordmap.html">Word Map</a>
    <a href="wordcloud.html">Word Cloud</a>
  </nav>

  <main class="card-glass">
    <div class="controls">
      <div class="controls-inner">
        <input type="text" id="wordInput" placeholder="Enter words (space or comma separated)" />
        <button class="btn" id="addWords">Add Words</button>
        <button class="btn alt" id="clearCloud">Clear Cloud</button>
      </div>
      <div class="word-count">Words: <span id="wordCount">0</span></div>
    </div>

    <div class="cloud-container" id="cloudContainer">
      <div class="empty-state">Enter words above or use URL with ?words=your,words,here</div>
    </div>
  </main>

  <div class="ts-info">Word size reflects frequency. Page never scrolls; the cloud scrolls internally if needed.</div>

  <script>
    // ====== Neural background mount (inline) ======
    (function mountNeural(){
      const el = document.getElementById('neuralNetwork');
      if(!el) return;
      const nodes = 20, connections = 10; const frag = document.createDocumentFragment();
      for(let i=0;i<nodes;i++){ const n = document.createElement('div'); n.className='nn-node'; n.style.left=Math.random()*100+'%'; n.style.top=Math.random()*100+'%'; n.style.animationDelay=(Math.random()*4)+'s'; frag.appendChild(n); }
      for(let i=0;i<connections;i++){ const c=document.createElement('div'); c.className='nn-conn'; c.style.left=(Math.random()*90)+'%'; c.style.top=(Math.random()*100)+'%'; c.style.width=(Math.random()*200+100)+'px'; c.style.transform=`rotate(${Math.random()*360}deg)`; c.style.animationDelay=(Math.random()*3)+'s'; frag.appendChild(c); }
      el.appendChild(frag);
    })();

    // ====== Word Cloud (aligned & viewport-safe) ======
    class WordCloud {
      constructor() {
        this.words = new Map();
        this.palette = [
          '#64ffda', '#00bcd4', '#80deea', '#a7ffeb', '#b388ff', '#82b1ff', '#b2ff59', '#ffd54f'
        ];
        this.container = document.getElementById('cloudContainer');
        this.countEl = document.getElementById('wordCount');
        this.init();
      }
      init(){
        document.getElementById('addWords').addEventListener('click', ()=>this.addWords());
        document.getElementById('wordInput').addEventListener('keypress', (e)=>{ if(e.key==='Enter') this.addWords(); });
        document.getElementById('clearCloud').addEventListener('click', ()=>this.clearCloud());
        this.checkURLParams();
        this.renderCloud();
        // Enforce no page scroll at runtime too
        document.documentElement.style.overflow = 'hidden';
        window.addEventListener('resize', ()=>this.renderCloud());
      }
      checkURLParams(){
        const params = new URLSearchParams(window.location.search);
        const wordsParam = params.get('words');
        if(wordsParam){
          const all = this.parseWordsAndPhrases(decodeURIComponent(wordsParam));
          this.words.clear();
          all.forEach(w=>{ const t=w.toLowerCase().trim(); if(t) this.words.set(t,(this.words.get(t)||0)+1); });
          window.history.replaceState({}, document.title, window.location.pathname);
        }
      }
      addWords(){
        const inputEl = document.getElementById('wordInput');
        const input = inputEl.value.trim(); if(!input) return;
        const list = this.parseWordsAndPhrases(input);
        list.forEach(w=>{ const t=w.toLowerCase().trim(); if(t) this.words.set(t,(this.words.get(t)||0)+1); });
        inputEl.value='';
        this.renderCloud();
      }
      parseWordsAndPhrases(input){
        const out=[]; let cur=''; let inQ=false;
        for(let i=0;i<input.length;i++){
          const ch=input[i];
          if(ch==='"'){ inQ=!inQ; if(!inQ && cur.trim()){ out.push(cur.trim()); cur=''; } }
          else if(!inQ && (ch===','||ch===' '||ch==='\n')){ if(cur.trim()){ out.push(cur.trim()); cur=''; } }
          else if(ch!=='\r'){ cur+=ch; }
        }
        if(cur.trim()) out.push(cur.trim());
        return out.filter(Boolean);
      }
      clearCloud(){ this.words.clear(); this.renderCloud(); }
      calcFontSize(count, maxCount){
        // size adapts to container to avoid forcing page scroll
        const cw = this.container.clientWidth || window.innerWidth;
        const ch = this.container.clientHeight || window.innerHeight;
        // Base sizes scale with viewport; keep within readable bounds
        let maxSize = Math.max(22, Math.min(Math.floor(cw/12), Math.floor(ch/7)));
        let minSize = Math.max(12, Math.min(16, Math.floor(ch/40)));
        const ratio = maxCount ? (count / maxCount) : 0.5;
        return Math.max(minSize, Math.round(minSize + (maxSize - minSize) * ratio));
      }
      color(){ return this.palette[Math.floor(Math.random()*this.palette.length)]; }
      renderCloud(){
        const total = Array.from(this.words.values()).reduce((s,c)=>s+c,0);
        this.countEl.textContent = total;
        if(this.words.size===0){
          this.container.innerHTML = '<div class="empty-state">Enter words above or use URL with ?words=your,words,here</div>';
          return;
        }
        const maxCount = Math.max(...this.words.values());
        const sorted = Array.from(this.words.entries()).sort((a,b)=> b[1]-a[1] || a[0].localeCompare(b[0]));

        // Density control: if many tokens, slightly compress sizes
        const density = sorted.length;
        const densityFactor = density > 80 ? 0.75 : density > 40 ? 0.85 : 1;

        const html = sorted.map(([w,c])=>{
          const fs = Math.round(this.calcFontSize(c, maxCount) * densityFactor);
          const col = this.color();
          return `<span class="word-item" style="font-size:${fs}px;color:${col};background:${col}15;border:1px solid ${col}35" title="${w} (appears ${c} time${c>1?'s':''})">${w}</span>`;
        }).join('');
        this.container.innerHTML = html;

        // Staggered animation via transition delay
        this.container.querySelectorAll('.word-item').forEach((el,i)=>{ el.style.transitionDelay = `${i*8}ms`; });
      }
    }

    new WordCloud();
  </script>
</body>
</html>
